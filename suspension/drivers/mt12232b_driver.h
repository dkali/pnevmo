#ifndef MT12232B_DRIVER_H
#define MT12232B_DRIVER_H

#include "../include/protocol_rpi.h"
#include <stdio.h>
#include <iostream>
#include <sstream>
#include <bitset>
#include <string>

using namespace std;

const int LCD_PIN_NUM = 13;

class MT12232B{
private:
    RPiGPIOPin A0; //Адресный сигнал - выбор между передачей данных и команд управления
    RPiGPIOPin E1; //Разрешение обращений к модулю (а также строб данных)(1 кристалл)
    RPiGPIOPin E2; //Разрешение обращений к модулю (а также строб данных)(2 кристалл)
    RPiGPIOPin RDWR; //Выбор режима записи или чтения
    RPiGPIOPin DB0; //Шина данных (младший бит)
    RPiGPIOPin DB1;
    RPiGPIOPin DB2;
    RPiGPIOPin DB3;
    RPiGPIOPin DB4;
    RPiGPIOPin DB5;
    RPiGPIOPin DB6;
    RPiGPIOPin DB7; //Шина данных (старший бит)
    RPiGPIOPin RES; //Сброс / Выбор типа интерфейса

    RPiGPIOPin lcd_pins[LCD_PIN_NUM];
    RPiGPIOPin lcd_databus_pins[8];
    
    void write_to_bus(int byte);

public:
    MT12232B();
    void init_A0( RPiGPIOPin pin );
    void init_E1( RPiGPIOPin pin );
    void init_E2( RPiGPIOPin pin );
    void init_RDWR( RPiGPIOPin pin );
    void init_databus( RPiGPIOPin pin0, RPiGPIOPin pin1, RPiGPIOPin pin2, RPiGPIOPin pin3, RPiGPIOPin pin4, RPiGPIOPin pin5, RPiGPIOPin pin6, RPiGPIOPin pin7 );
    void init_RES( RPiGPIOPin pin );

    void turn_on();

    void cmd_reset();
    void cmd_rmw();
    void cmd_rmw_end();
    void cmd_static_drive(bool bEnable);
    void cmd_duty_select();
    void cmd_display_start_line(int linenum);
    void cmd_adc_select(int direction);
    void cmd_display_onoff(bool on);
    void cmd_set_page(int pnum);
    void cmd_set_address(int column_address);
    
    void write_byte(int byte, int cd, int l, int r); //Процедура выдачи байта в индикатор
    void clear_all_pins();
};

const int Logo122[4][122]=//122x32 pixel, каждые 8 вертикальных точек собраны в байт
{
    {    0xFF,0x01,0x01,0x01,0x01,0xC1,0xE1,0xB1,0x11,0x1D,0x1D,0x7F,0x7F,0xFF,0xFF,0xFF,
        0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFD,0xFD,0xF9,0xB1,
        0xF1,0xE1,0x81,0x01,0x01,0x01,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,
        0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,
        0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,
        0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,
        0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,
        0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xC1,0xFF
    },
    {    0xFF,0xE0,0x7C,0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8,0x6F,0x6F,0x07,
        0x07,0x06,0x00,0x00,0x03,0x03,0x0F,0x3F,0x07,0x07,0x07,0x03,0x03,0x07,0x0F,0x3B,
        0x13,0x80,0x80,0x23,0x9E,0xF8,0xF8,0xF8,0xFC,0xFE,0xFE,0xFE,0xFC,0x00,0x00,0x00,
        0x80,0x80,0xE0,0xF8,0xFC,0xFE,0xFE,0xFE,0xFC,0x00,0x00,0x00,0x60,0xF0,0xF8,0xF8,
        0x7C,0x3E,0x1E,0x1E,0x1E,0x1E,0x1E,0x1E,0x1E,0x3E,0x3E,0x7E,0xFC,0xF8,0xF0,0xE0,
        0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0xF8,0xFC,0xFE,
        0xFE,0xFE,0xFE,0xFC,0x00,0x1C,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0xFE,0xFE,0xFE,
        0xFE,0xFE,0x3E,0x3E,0x3E,0x3E,0x3E,0x3E,0x1C,0xFF
    },
    {    0xFF,0x07,0x7C,0xE0,0x80,0x00,0x1F,0x3F,0xFF,0xFF,0xFF,0xFF,0x0F,0x30,0x38,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,
        0xE0,0xF0,0xFC,0xFF,0xFF,0x3F,0x0F,0x03,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8,0xFE,0xFF,
        0x7F,0x7F,0x1F,0x0F,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x18,0x3C,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x3C,0x3C,0x18,0x00,0x00,0x01,0xFF,
        0xFF,0xFF,0xFF,0x00,0x00,0x80,0xE0,0xF0,0xFC,0xFE,0xFF,0x7F,0x1F,0x07,0xFF,0xFF,
        0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,
        0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF
    },
    {    0xFF,0x80,0x80,0x80,0x80,0x83,0x86,0x8C,0x98,0xB0,0xB0,0xE0,0xC0,0xC0,0x80,0x80,
        0x80,0x80,0x80,0x80,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xE0,0xF8,0xFC,0xFF,0xFF,
        0xBF,0x8F,0x87,0x81,0x80,0x80,0x80,0x80,0xFF,0xFF,0xFF,0xFF,0xFF,0x9F,0x83,0x80,
        0x80,0x80,0x80,0x80,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,0x80,0x80,0x86,0x8F,0x9F,0xBF,
        0xFE,0xFC,0xF8,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFE,0xBF,0x9F,0x8F,
        0x87,0xE3,0xF9,0xFC,0xFF,0xFF,0xBF,0x9F,0x87,0x81,0x80,0x80,0x80,0x80,0xFF,0xFF,
        0xFF,0xFF,0xFF,0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF,0xFF,0xFF,
        0xFF,0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF
    }
};

#endif //MT12232B_DRIVER_H